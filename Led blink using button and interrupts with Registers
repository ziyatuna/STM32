#include "main.h"
void Clock_Config(void);
void GPIO_Config(void);
void EXTI_Config(void);
void EXTI0_IRQHandler(void);
uint8_t led=12;
int main(void)
{
	Clock_Config();
	GPIO_Config();
	EXTI_Config();
  while (1)
  {

  }
}


void Clock_Config(void)
{
	RCC->CR |= (1<<16)|(1<<24);// HSEON and PLLON is enabled.
	while(!(RCC->CR&(1<<17)));//Wait for HSERDY to 1.
	RCC->CR |=(1<<19);// CSS enable.
	RCC->PLLCFGR |=(1<<22);// PLLSRC is choosen HSE.
	//SYSCLK=[(HSE/PLLM)*PLLN]/PLLP
	RCC->PLLCFGR |=(1<<2);//PLLM=4
	RCC->PLLCFGR |=(1<<9)|(1<<11)|(1<<13);//PLLN=168
	RCC->PLLCFGR |=0;//PLLP=2
	RCC->CFGR |= 0;// AHB Prescaler=1
	RCC->CFGR |= (1<<10)|(1<<12)|(1<<15);// APB1 Prescaler=4, APB2 Prescaler=2
	RCC->CIR |= (1<<19); //HSERDY Flag is cleared.
	RCC->CIR |= (1<<23); //CSS Flag is cleared.
	//RCC->AHB1RSTR |= (1<<0)|(1<<1)|(1<<2)|(1<<3);//GPIO A/B/C/D Ports reset.
}

void GPIO_Config(void)
{
	RCC->AHB1ENR|=(1<<0)|(1<<3);//Set GPIOA and GPIOD
	GPIOD->MODER|=(1<<24)|(1<<26)|(1<<28)|(1<<30);//Set led
	GPIOA->PUPDR|=(1<<1);// Set pull up/ pull down .
}

void EXTI_Config(void)
{

	RCC->APB2ENR |= (1<<14);// APB2 system clock is enabled.
	SYSCFG->EXTICR[0]|= 0;//Set  interrupt to come from port a.
	EXTI->IMR |= (1<<0); //Set interrupt to come from  zeroth pin.
	EXTI->RTSR |= (1<<0); // Set interrupt to occur on rising edge.
	NVIC->ISER[0]|=(1<<6);//EXTIO interrupt is activated.
}
void EXTI0_IRQHandler(void)
{
	EXTI->PR |= (1<<0);//Reset by set 1 to first bit
	GPIOD->ODR ^=(1<<led);
	led+=1;
	if(led==16)
		led=12;
}
